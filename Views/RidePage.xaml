<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="OrbanaDrive.Views.RidePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
    BackgroundColor="{StaticResource PageBackgroundColor}"
    Title="Servicio"
    NavigationPage.HasBackButton="False">

    <Shell.BackButtonBehavior>
        <BackButtonBehavior IsEnabled="False" />
    </Shell.BackButtonBehavior>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Cancelar" Clicked="OnCancelRideClicked" />
    </ContentPage.ToolbarItems>

    <!-- 3 filas: mapa / info / botones -->
    <Grid RowDefinitions="*,Auto,Auto">

        <!-- MAPA -->
        <Grid Grid.Row="0">
            <maps:Map x:Name="RideMap" MapType="Street" IsTrafficEnabled="True"/>

            <!-- FAB -->
            <Grid>
                <Grid VerticalOptions="End" HorizontalOptions="Start" Margin="12">
                    <ImageButton Source="ride_icon.png"
                   WidthRequest="70" HeightRequest="70"
                   BackgroundColor="Transparent" CornerRadius="22"
                   Padding="8" Opacity="0.95"
                   Clicked="OnOpenInGoogleMapsClicked"/>
                </Grid>
            </Grid>

            <!-- PICKUP HINT -->
            <Grid VerticalOptions="Start" HorizontalOptions="Start" Margin="12">
                <Border x:Name="PickupHint"
            IsVisible="False"
            Padding="10,6"
            Stroke="#333333"
            StrokeThickness="1"
            BackgroundColor="#1C1C1C"
            StrokeShape="RoundRectangle 12"
            Opacity="0.95">
                    <Label x:Name="PickupHintLabel"
             Text="Pickup: —"
             FontSize="12"
             TextColor="#E0E0E0" />
                </Border>
            </Grid>
        </Grid>


        <!-- INFO -->
        <Frame Grid.Row="1" Margin="12,8,12,6" Padding="12,10"
               CornerRadius="18" HasShadow="False"
               BackgroundColor="#121212" BorderColor="#2A2A2A">
            <Grid RowDefinitions="Auto,Auto,Auto,Auto"
                  ColumnDefinitions="*,Auto"
                  ColumnSpacing="8" RowSpacing="8">

                <!-- chip + ETA -->
                <Border Grid.Row="0" Grid.Column="0"
                        Stroke="#3A3A3A" StrokeThickness="1"
                        StrokeShape="RoundRectangle 10" Padding="8,4">
                    <Label x:Name="StatusChip" Text="Asignado" FontSize="11" TextColor="#E67E80"/>
                </Border>
                <Label Grid.Row="0" Grid.Column="1" x:Name="EtaLabel"
                       Text="ETA —" FontSize="11"
                       TextColor="{StaticResource ClrTextSecondary}"
                       HorizontalTextAlignment="End" VerticalTextAlignment="Center"/>

                <!-- monto -->
                <Label Grid.Row="1" Grid.ColumnSpan="2" x:Name="AmountLabel"
                       Text="MXN —" FontAttributes="Bold" FontSize="20"
                       TextColor="{StaticResource ClrTextPrimary}" />

                <!-- origen -->
                <Grid Grid.Row="2" Grid.ColumnSpan="2" ColumnDefinitions="Auto,*" ColumnSpacing="10">
                    <Border Background="#2F6FED" StrokeThickness="0"
                            StrokeShape="RoundRectangle 11" WidthRequest="22" HeightRequest="22">
                        <Label Text="A" TextColor="White" FontAttributes="Bold"
                               HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                    </Border>
                    <Label Grid.Column="1" x:Name="OriginLabel" FontSize="13"
                           TextColor="{StaticResource ClrTextPrimary}"
                           LineBreakMode="WordWrap" MaxLines="2"/>
                </Grid>

                <!-- destino -->
                <Grid Grid.Row="3" Grid.ColumnSpan="2" ColumnDefinitions="Auto,*" ColumnSpacing="10">
                    <Border Background="#2ECC71" StrokeThickness="0"
                            StrokeShape="RoundRectangle 11" WidthRequest="22" HeightRequest="22">
                        <Label Text="B" TextColor="White" FontAttributes="Bold"
                               HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                    </Border>
                    <Label Grid.Column="1" x:Name="DestLabel" FontSize="13"
                           TextColor="{StaticResource ClrTextSecondary}"
                           LineBreakMode="WordWrap" MaxLines="2"/>
                </Grid>
            </Grid>
        </Frame>

        <!-- BOTONES (uno por fila, ancho completo) -->
        <Grid Grid.Row="2"
              Padding="12,0,12,28"
              ColumnDefinitions="*"
              RowDefinitions="Auto,Auto,Auto"
              RowSpacing="10">

            <Button x:Name="ArrivedBtn"
                    Grid.Row="0" Text="Llegué"
                    HeightRequest="50" CornerRadius="12"
                    HorizontalOptions="Fill"
                    Clicked="OnArrivedClicked"/>

            <Button x:Name="BoardBtn"
                    Grid.Row="1" Text="A bordo"
                    HeightRequest="50" CornerRadius="12"
                    HorizontalOptions="Fill"
                    IsVisible="False"
                    Clicked="OnBoardClicked"/>

            <Button x:Name="FinishBtn"
                    Grid.Row="2" Text="Finalizar"
                    HeightRequest="50" CornerRadius="12"
                    HorizontalOptions="Fill"
                    IsVisible="False"
                    Clicked="OnFinishClicked"/>
        </Grid>
    </Grid>
</ContentPage>
